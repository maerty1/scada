# Настройка службы SCADA Collector

## Конфигурация в config.json

Учетные данные для запуска службы хранятся в секции `service`:

```json
{
    "service": {
        "run_as_user": "user@domain",
        "run_as_password": "P@ssw0rd"
    }
}
```

**Важно:** Авторизация в сетевую папку происходит **через учетную запись службы Windows**. Служба должна быть запущена от имени доменного пользователя с правами доступа к сетевой папке.

## Установка и настройка службы

### 1. Установка службы

Запустите `install_service.bat` от имени администратора:
- Установит службу SCADA_Collector
- Настроит автоматический запуск
- Настроит логирование
- Настроит переменные окружения (PYTHONPATH)

**Служба будет запускаться от имени SYSTEM** - это нормально для начальной установки.

### 2. Настройка доменного пользователя

Запустите `setup_service_user.bat` от имени администратора:
- Прочитает учетные данные из `config.json` (секция `service`)
- Настроит службу для запуска от имени доменного пользователя
- Настроит переменные окружения (PYTHONPATH)
- Перезапустит службу

**После настройки служба будет использовать учетные данные доменного пользователя для доступа к сетевым ресурсам.**

## Проверка службы

После настройки проверьте:

1. **Статус службы:**
   ```cmd
   .\nssm.exe status SCADA_Collector
   ```
   Должен быть: `SERVICE_RUNNING`

2. **Процессы Python:**
   ```cmd
   tasklist | findstr python
   ```
   Должен быть виден процесс `python.exe`

3. **Логи:**
   - `service_stdout.log` - стандартный вывод
   - `service_stderr.log` - ошибки
   - `sync.log` - основные логи приложения
   
   В логах должны быть сообщения:
   ```
   TC2: Авторизация в сетевую папку выполняется через учетную запись службы Windows
   TC2: Сетевая папка доступна
   ```

4. **Доступ к сетевой папке:**
   Приложение использует учетные данные пользователя, от имени которого запущена служба Windows.
   Служба должна быть запущена от имени доменного пользователя с правами доступа к сетевой папке.

## Как работает авторизация

1. Служба запускается от имени **доменного пользователя** (настроено через `setup_service_user.bat`)
2. Windows автоматически использует учетные данные этого пользователя для доступа к сетевым ресурсам
3. Приложение получает доступ к файлам в сетевой папке с правами пользователя службы
4. Никаких дополнительных действий в коде не требуется

## Важно

- Все скрипты настройки службы должны запускаться **от имени администратора**
- Убедитесь, что пользователь из `config.json` имеет права доступа к сетевой папке
- После изменения учетных данных в `config.json` **перезапустите службу** - изменения применятся автоматически
- Служба может запускаться от имени SYSTEM - авторизация происходит через приложение

